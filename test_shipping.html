<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Shipping JavaScript</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Test de M√©todos de Env√≠o</h2>
        
        <!-- Simular el HTML que genera Django -->
        <div class="mb-4">
            <h6 class="fw-bold text-black mb-3">
                <i class="fas fa-shipping-fast me-2"></i>
                M√©todo de Env√≠o
            </h6>
            <div class="shipping-options">
                <div>
                    <label for="id_shipping_method_0">
                        <input type="radio" name="shipping_method" value="1" class="form-check-input" id="id_shipping_method_0">
                        OCA - $3000 (3-5 d√≠as h√°biles)
                    </label>
                </div>
                <div>
                    <label for="id_shipping_method_1">
                        <input type="radio" name="shipping_method" value="2" class="form-check-input" id="id_shipping_method_1">
                        Andreani - $3600 (2-4 d√≠as h√°biles)
                    </label>
                </div>
                <div>
                    <label for="id_shipping_method_2">
                        <input type="radio" name="shipping_method" value="3" class="form-check-input" id="id_shipping_method_2">
                        Correo Argentino - $2400 (4-7 d√≠as h√°biles)
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Resumen de costos -->
        <div class="border rounded p-3 mb-4" style="background: linear-gradient(45deg, #f8f9fa, #ffffff);">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span>Subtotal de productos:</span>
                <span class="fw-bold">$28.999</span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span>Costo de env√≠o:</span>
                <span id="shipping-cost" class="fw-bold">Selecciona m√©todo</span>
            </div>
            <hr>
            <div class="d-flex justify-content-between align-items-center">
                <span class="fw-bold">Total final:</span>
                <span id="total-final" class="fw-bold text-success fs-5">$28.999</span>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ DEBUGGING: DOM loaded');
        
        const shippingOptions = document.querySelectorAll('input[name="shipping_method"]');
        const shippingCostSpan = document.getElementById('shipping-cost');
        const totalFinalSpan = document.getElementById('total-final');
        const subtotal = 28999;
        
        console.log('üîç DEBUGGING: shippingOptions found:', shippingOptions.length);
        console.log('üîç DEBUGGING: shippingCostSpan:', shippingCostSpan);
        console.log('üîç DEBUGGING: totalFinalSpan:', totalFinalSpan);
        console.log('üîç DEBUGGING: subtotal:', subtotal);
        
        // Datos de m√©todos de env√≠o
        const shippingMethods = {
            1: {
                name: 'OCA',
                baseCost: 2500,
                costPerKg: 500,
                freeThreshold: 50000,
                estimatedDays: '3-5 d√≠as h√°biles'
            },
            2: {
                name: 'Andreani',
                baseCost: 3000,
                costPerKg: 600,
                freeThreshold: 60000,
                estimatedDays: '2-4 d√≠as h√°biles'
            },
            3: {
                name: 'Correo Argentino',
                baseCost: 2000,
                costPerKg: 400,
                freeThreshold: 45000,
                estimatedDays: '4-7 d√≠as h√°biles'
            }
        };
        
        console.log('üîç DEBUGGING: shippingMethods:', shippingMethods);
        
        function updateShippingCost() {
            console.log('üîÑ DEBUGGING: updateShippingCost called');
            const selectedOption = document.querySelector('input[name="shipping_method"]:checked');
            console.log('üîÑ DEBUGGING: selectedOption:', selectedOption);
            
            if (!selectedOption) {
                console.log('‚ö†Ô∏è DEBUGGING: No option selected');
                shippingCostSpan.textContent = 'Selecciona m√©todo';
                totalFinalSpan.textContent = `$${subtotal.toLocaleString('es-AR')}`;
                return;
            }
            
            const methodId = parseInt(selectedOption.value);
            const method = shippingMethods[methodId];
            console.log('üîÑ DEBUGGING: methodId:', methodId, 'method:', method);
            
            if (!method) {
                console.log('‚ùå DEBUGGING: Method not found for ID:', methodId);
                return;
            }
            
            let shippingCost = method.baseCost + (method.costPerKg * 1);
            console.log('üîÑ DEBUGGING: calculated shippingCost:', shippingCost);
            
            // Verificar si aplica env√≠o gratis
            if (method.freeThreshold && subtotal >= method.freeThreshold) {
                shippingCost = 0;
                console.log('üîÑ DEBUGGING: Free shipping applied!');
            }
            
            const total = subtotal + shippingCost;
            console.log('üîÑ DEBUGGING: final total:', total);
            
            if (shippingCost === 0) {
                shippingCostSpan.textContent = 'GRATIS';
                shippingCostSpan.className = 'fw-bold text-success';
            } else {
                shippingCostSpan.textContent = `$${shippingCost.toLocaleString('es-AR')}`;
                shippingCostSpan.className = 'fw-bold';
            }
            
            totalFinalSpan.textContent = `$${total.toLocaleString('es-AR')}`;
            console.log('‚úÖ DEBUGGING: UI updated');
        }
        
        // Agregar listeners a los radio buttons
        console.log('üéØ DEBUGGING: Adding event listeners...');
        shippingOptions.forEach((option, index) => {
            console.log(`üéØ DEBUGGING: Adding listener to option ${index}, value: ${option.value}`);
            option.addEventListener('change', function() {
                console.log('üî• DEBUGGING: Radio button changed, value:', this.value);
                updateShippingCost();
            });
        });
        
        console.log('üîÑ DEBUGGING: Calling initial updateShippingCost...');
        // Actualizar al cargar
        updateShippingCost();
    });
    </script>
</body>
</html>
